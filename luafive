-- Ultimate Training Multiplier Script
-- Menggunakan Delta Executor dengan GUI Modern

local Players = game:GetService("Players")
local RS = game:GetService("ReplicatedStorage")
local UIS = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

-- ==================== KONFIGURASI ====================
local Config = {
    -- Training Settings
    TrainSpeed = 9e999,
    TrainMultiplier = 1e15,  -- 1 Quadrillion multiplier
    Threads = 150,
    BaseDelay = 0,
    
    -- Item Settings (buff items)
    Items = {
        Arms = 18,      -- Item18 untuk Arms
        Back = 19,      -- Item19 untuk Back  
        Legs = 20,      -- Item20 untuk Legs
        Agility = 21    -- Item21 untuk Agility
    },
    
    -- Auto Use Items
    AutoUseItems = true,
    ItemUseInterval = 5, -- seconds
    
    -- Combat Power Boost
    CPMultiplier = 1e18, -- 1 Quintillion
    
    -- System
    Running = false,
    Threads = {}
}

-- ==================== REMOTE REFERENCES ====================
local Remotes = {
    -- Train Equipment
    EquipStation = RS.TrainEquipment.Remote.ApplyTakeUpStationaryTrainEquipment,
    Stationary = RS.TrainEquipment.Remote.ApplyStationaryTrain,
    Mobile = RS.TrainEquipment.Remote.ApplyMobileTrain,
    
    -- Train System  
    TrainSpeed = RS.TrainSystem.Remote.TrainSpeedHasChanged,
    CombatPower = RS.TrainSystem.Remote.PlayerCombatPowerHasChanged,
    TrainValueBindable = RS.TrainSystem.Bindable.PlayerTrainValueHasChanged,
    
    -- Items
    UseItem = RS.PlayerItemBackpack.Remote.TryOperatingItemByPlayer,
    
    -- Buff
    AddBuff = RS.Buff.Remote.AddBuffSucc
}

-- ==================== UTILITY FUNCTIONS ====================
local function SafeCall(func, ...)
    local success, result = pcall(func, ...)
    if not success then
        warn("SafeCall Error:", result)
        return false, result
    end
    return true, result
end

local function GetPlayer()
    return Players.LocalPlayer
end

-- ==================== ITEM SYSTEM ====================
local function UseBuffItem(itemId, count)
    count = count or 1
    SafeCall(function()
        for i = 1, count do
            Remotes.UseItem:InvokeServer({
                GridInfo = {
                    Id = itemId,
                    Num = 1
                },
                GridIndex = tostring(400 + itemId)
            }, itemId, 1, {
                Operation = "UseItem",
                PointingOperation = "UseSingleBuffConsum"
            })
            task.wait(0.1)
        end
    end)
end

local function AutoUseAllItems()
    while Config.Running and Config.AutoUseItems do
        -- Use semua buff items
        for name, id in pairs(Config.Items) do
            UseBuffItem(id, 5) -- Use 5x untuk stack
            task.wait(0.2)
        end
        task.wait(Config.ItemUseInterval)
    end
end

-- ==================== TRAINING CORE ====================
local function BoostCombatPower()
    SafeCall(function()
        local player = GetPlayer()
        -- Boost Combat Power dengan multiplier besar
        for i = 1, 10 do
            firesignal(Remotes.CombatPower.OnClientEvent, 
                player, 
                math.huge * Config.CPMultiplier
            )
            task.wait(0.05)
        end
    end)
end

local function BoostTrainValues()
    SafeCall(function()
        local player = GetPlayer()
        -- Boost semua train values (Arms, Legs, Back, Agility)
        for trainType = 1, 4 do
            for i = 1, 5 do
                firesignal(RS.TrainSystem.Bindable.PlayerTrainValueHasChanged.Fire,
                    player,
                    trainType,
                    math.huge * Config.TrainMultiplier,
                    math.huge * Config.TrainMultiplier
                )
                task.wait(0.05)
            end
        end
    end)
end

local function TrainCycle()
    SafeCall(function()
        -- Execute training sequence
        Remotes.Stationary:InvokeServer()
        task.wait(0.01)
        Remotes.Mobile:InvokeServer()
        task.wait(0.01)
        Remotes.TrainSpeed:FireServer(Config.TrainSpeed)
        
        -- Apply multipliers
        BoostTrainValues()
        BoostCombatPower()
    end)
end

-- ==================== THREAD MANAGEMENT ====================
local function StopAllThreads()
    Config.Running = false
    for _, thread in pairs(Config.Threads) do
        task.cancel(thread)
    end
    Config.Threads = {}
end

local function StartTraining()
    if Config.Running then return end
    Config.Running = true
    
    -- Equip training equipment
    SafeCall(function()
        Remotes.EquipStation:InvokeServer("2008")
    end)
    
    -- Start main training threads
    for i = 1, Config.Threads do
        local thread = task.spawn(function()
            while Config.Running do
                TrainCycle()
                task.wait(Config.BaseDelay)
            end
        end)
        table.insert(Config.Threads, thread)
    end
    
    -- Start auto item use thread
    if Config.AutoUseItems then
        local itemThread = task.spawn(AutoUseAllItems)
        table.insert(Config.Threads, itemThread)
    end
end

-- ==================== GUI CREATION ====================
local function CreateGUI()
    -- Destroy existing GUI
    if game.CoreGui:FindFirstChild("UltimateTrainGUI") then
        game.CoreGui.UltimateTrainGUI:Destroy()
    end
    
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "UltimateTrainGUI"
    ScreenGui.Parent = game.CoreGui
    ScreenGui.ResetOnSpawn = false
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    -- Main Frame
    local MainFrame = Instance.new("Frame")
    MainFrame.Name = "MainFrame"
    MainFrame.Size = UDim2.new(0, 400, 0, 500)
    MainFrame.Position = UDim2.new(0.5, -200, 0.5, -250)
    MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    MainFrame.BorderSizePixel = 0
    MainFrame.Parent = ScreenGui
    
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 12)
    UICorner.Parent = MainFrame
    
    local UIStroke = Instance.new("UIStroke")
    UIStroke.Color = Color3.fromRGB(60, 120, 255)
    UIStroke.Thickness = 2
    UIStroke.Parent = MainFrame
    
    -- Title Bar
    local TitleBar = Instance.new("Frame")
    TitleBar.Name = "TitleBar"
    TitleBar.Size = UDim2.new(1, 0, 0, 40)
    TitleBar.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
    TitleBar.BorderSizePixel = 0
    TitleBar.Parent = MainFrame
    
    local TitleCorner = Instance.new("UICorner")
    TitleCorner.CornerRadius = UDim.new(0, 12)
    TitleCorner.Parent = TitleBar
    
    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(0.7, 0, 1, 0)
    Title.Position = UDim2.new(0, 10, 0, 0)
    Title.BackgroundTransparency = 1
    Title.Text = "💪 Ultimate Training Multiplier"
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.TextSize = 16
    Title.Font = Enum.Font.GothamBold
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.Parent = TitleBar
    
    -- Minimize Button
    local MinimizeBtn = Instance.new("TextButton")
    MinimizeBtn.Size = UDim2.new(0, 30, 0, 30)
    MinimizeBtn.Position = UDim2.new(1, -70, 0, 5)
    MinimizeBtn.BackgroundColor3 = Color3.fromRGB(255, 200, 0)
    MinimizeBtn.Text = "─"
    MinimizeBtn.TextColor3 = Color3.fromRGB(0, 0, 0)
    MinimizeBtn.TextSize = 20
    MinimizeBtn.Font = Enum.Font.GothamBold
    MinimizeBtn.Parent = TitleBar
    
    local MinCorner = Instance.new("UICorner")
    MinCorner.CornerRadius = UDim.new(0, 6)
    MinCorner.Parent = MinimizeBtn
    
    -- Close Button
    local CloseBtn = Instance.new("TextButton")
    CloseBtn.Size = UDim2.new(0, 30, 0, 30)
    CloseBtn.Position = UDim2.new(1, -35, 0, 5)
    CloseBtn.BackgroundColor3 = Color3.fromRGB(255, 60, 60)
    CloseBtn.Text = "✕"
    CloseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    CloseBtn.TextSize = 18
    CloseBtn.Font = Enum.Font.GothamBold
    CloseBtn.Parent = TitleBar
    
    local CloseCorner = Instance.new("UICorner")
    CloseCorner.CornerRadius = UDim.new(0, 6)
    CloseCorner.Parent = CloseBtn
    
    -- Content Frame
    local Content = Instance.new("ScrollingFrame")
    Content.Size = UDim2.new(1, -20, 1, -50)
    Content.Position = UDim2.new(0, 10, 0, 45)
    Content.BackgroundTransparency = 1
    Content.ScrollBarThickness = 4
    Content.BorderSizePixel = 0
    Content.Parent = MainFrame
    
    -- Create Sections
    local yPos = 10
    
    -- Status Section
    local StatusLabel = Instance.new("TextLabel")
    StatusLabel.Size = UDim2.new(1, -10, 0, 30)
    StatusLabel.Position = UDim2.new(0, 5, 0, yPos)
    StatusLabel.BackgroundColor3 = Color3.fromRGB(40, 40, 55)
    StatusLabel.Text = "⭕ Status: Stopped"
    StatusLabel.TextColor3 = Color3.fromRGB(255, 80, 80)
    StatusLabel.TextSize = 14
    StatusLabel.Font = Enum.Font.GothamBold
    StatusLabel.Parent = Content
    
    local StatusCorner = Instance.new("UICorner")
    StatusCorner.CornerRadius = UDim.new(0, 8)
    StatusCorner.Parent = StatusLabel
    
    yPos = yPos + 40
    
    -- Start/Stop Button
    local ToggleBtn = Instance.new("TextButton")
    ToggleBtn.Size = UDim2.new(1, -10, 0, 45)
    ToggleBtn.Position = UDim2.new(0, 5, 0, yPos)
    ToggleBtn.BackgroundColor3 = Color3.fromRGB(60, 180, 60)
    ToggleBtn.Text = "🚀 START TRAINING"
    ToggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    ToggleBtn.TextSize = 16
    ToggleBtn.Font = Enum.Font.GothamBold
    ToggleBtn.Parent = Content
    
    local ToggleCorner = Instance.new("UICorner")
    ToggleCorner.CornerRadius = UDim.new(0, 10)
    ToggleCorner.Parent = ToggleBtn
    
    yPos = yPos + 55
    
    -- Settings Header
    local SettingsHeader = Instance.new("TextLabel")
    SettingsHeader.Size = UDim2.new(1, -10, 0, 25)
    SettingsHeader.Position = UDim2.new(0, 5, 0, yPos)
    SettingsHeader.BackgroundTransparency = 1
    SettingsHeader.Text = "⚙️ SETTINGS"
    SettingsHeader.TextColor3 = Color3.fromRGB(100, 180, 255)
    SettingsHeader.TextSize = 14
    SettingsHeader.Font = Enum.Font.GothamBold
    SettingsHeader.TextXAlignment = Enum.TextXAlignment.Left
    SettingsHeader.Parent = Content
    
    yPos = yPos + 30
    
    -- Create Setting Function
    local function CreateSetting(name, currentValue, callback)
        local SettingFrame = Instance.new("Frame")
        SettingFrame.Size = UDim2.new(1, -10, 0, 40)
        SettingFrame.Position = UDim2.new(0, 5, 0, yPos)
        SettingFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
        SettingFrame.BorderSizePixel = 0
        SettingFrame.Parent = Content
        
        local SettingCorner = Instance.new("UICorner")
        SettingCorner.CornerRadius = UDim.new(0, 8)
        SettingCorner.Parent = SettingFrame
        
        local Label = Instance.new("TextLabel")
        Label.Size = UDim2.new(0.6, 0, 1, 0)
        Label.Position = UDim2.new(0, 10, 0, 0)
        Label.BackgroundTransparency = 1
        Label.Text = name
        Label.TextColor3 = Color3.fromRGB(200, 200, 200)
        Label.TextSize = 12
        Label.Font = Enum.Font.Gotham
        Label.TextXAlignment = Enum.TextXAlignment.Left
        Label.Parent = SettingFrame
        
        local ValueBox = Instance.new("TextBox")
        ValueBox.Size = UDim2.new(0.35, 0, 0, 25)
        ValueBox.Position = UDim2.new(0.63, 0, 0.5, -12.5)
        ValueBox.BackgroundColor3 = Color3.fromRGB(45, 45, 60)
        ValueBox.Text = tostring(currentValue)
        ValueBox.TextColor3 = Color3.fromRGB(255, 255, 255)
        ValueBox.TextSize = 12
        ValueBox.Font = Enum.Font.GothamMedium
        ValueBox.Parent = SettingFrame
        
        local BoxCorner = Instance.new("UICorner")
        BoxCorner.CornerRadius = UDim.new(0, 6)
        BoxCorner.Parent = ValueBox
        
        ValueBox.FocusLost:Connect(function()
            callback(ValueBox.Text)
        end)
        
        yPos = yPos + 45
    end
    
    CreateSetting("Train Multiplier:", "1e15", function(val)
        Config.TrainMultiplier = tonumber(val) or 1e15
    end)
    
    CreateSetting("CP Multiplier:", "1e18", function(val)
        Config.CPMultiplier = tonumber(val) or 1e18
    end)
    
    CreateSetting("Threads:", Config.Threads, function(val)
        Config.Threads = tonumber(val) or 150
    end)
    
    CreateSetting("Item Use Interval (s):", Config.ItemUseInterval, function(val)
        Config.ItemUseInterval = tonumber(val) or 5
    end)
    
    -- Auto Use Items Toggle
    local AutoItemFrame = Instance.new("Frame")
    AutoItemFrame.Size = UDim2.new(1, -10, 0, 40)
    AutoItemFrame.Position = UDim2.new(0, 5, 0, yPos)
    AutoItemFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
    AutoItemFrame.BorderSizePixel = 0
    AutoItemFrame.Parent = Content
    
    local AutoItemCorner = Instance.new("UICorner")
    AutoItemCorner.CornerRadius = UDim.new(0, 8)
    AutoItemCorner.Parent = AutoItemFrame
    
    local AutoItemLabel = Instance.new("TextLabel")
    AutoItemLabel.Size = UDim2.new(0.7, 0, 1, 0)
    AutoItemLabel.Position = UDim2.new(0, 10, 0, 0)
    AutoItemLabel.BackgroundTransparency = 1
    AutoItemLabel.Text = "Auto Use Items"
    AutoItemLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    AutoItemLabel.TextSize = 12
    AutoItemLabel.Font = Enum.Font.Gotham
    AutoItemLabel.TextXAlignment = Enum.TextXAlignment.Left
    AutoItemLabel.Parent = AutoItemFrame
    
    local AutoItemToggle = Instance.new("TextButton")
    AutoItemToggle.Size = UDim2.new(0, 50, 0, 25)
    AutoItemToggle.Position = UDim2.new(1, -60, 0.5, -12.5)
    AutoItemToggle.BackgroundColor3 = Color3.fromRGB(60, 180, 60)
    AutoItemToggle.Text = "ON"
    AutoItemToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
    AutoItemToggle.TextSize = 11
    AutoItemToggle.Font = Enum.Font.GothamBold
    AutoItemToggle.Parent = AutoItemFrame
    
    local AutoToggleCorner = Instance.new("UICorner")
    AutoToggleCorner.CornerRadius = UDim.new(0, 6)
    AutoToggleCorner.Parent = AutoItemToggle
    
    yPos = yPos + 45
    
    -- Info Section
    local InfoLabel = Instance.new("TextLabel")
    InfoLabel.Size = UDim2.new(1, -10, 0, 80)
    InfoLabel.Position = UDim2.new(0, 5, 0, yPos)
    InfoLabel.BackgroundColor3 = Color3.fromRGB(40, 40, 55)
    InfoLabel.Text = "📌 Info:\n• Multiplier mencapai Quintillion\n• Auto buff semua stats\n• Hotkey: F untuk stop"
    InfoLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
    InfoLabel.TextSize = 11
    InfoLabel.Font = Enum.Font.Gotham
    InfoLabel.TextWrapped = true
    InfoLabel.TextYAlignment = Enum.TextYAlignment.Top
    InfoLabel.Parent = Content
    
    local InfoCorner = Instance.new("UICorner")
    InfoCorner.CornerRadius = UDim.new(0, 8)
    InfoCorner.Parent = InfoLabel
    
    Content.CanvasSize = UDim2.new(0, 0, 0, yPos + 100)
    
    -- ==================== GUI LOGIC ====================
    
    -- Toggle Button Logic
    ToggleBtn.MouseButton1Click:Connect(function()
        if Config.Running then
            StopAllThreads()
            ToggleBtn.Text = "🚀 START TRAINING"
            ToggleBtn.BackgroundColor3 = Color3.fromRGB(60, 180, 60)
            StatusLabel.Text = "⭕ Status: Stopped"
            StatusLabel.TextColor3 = Color3.fromRGB(255, 80, 80)
        else
            StartTraining()
            ToggleBtn.Text = "⏹️ STOP TRAINING"
            ToggleBtn.BackgroundColor3 = Color3.fromRGB(255, 60, 60)
            StatusLabel.Text = "✅ Status: Running"
            StatusLabel.TextColor3 = Color3.fromRGB(60, 255, 60)
        end
    end)
    
    -- Auto Item Toggle Logic
    AutoItemToggle.MouseButton1Click:Connect(function()
        Config.AutoUseItems = not Config.AutoUseItems
        if Config.AutoUseItems then
            AutoItemToggle.Text = "ON"
            AutoItemToggle.BackgroundColor3 = Color3.fromRGB(60, 180, 60)
        else
            AutoItemToggle.Text = "OFF"
            AutoItemToggle.BackgroundColor3 = Color3.fromRGB(180, 60, 60)
        end
    end)
    
    -- Close Button Logic
    CloseBtn.MouseButton1Click:Connect(function()
        StopAllThreads()
        ScreenGui:Destroy()
    end)
    
    -- Minimize Logic
    local minimized = false
    MinimizeBtn.MouseButton1Click:Connect(function()
        minimized = not minimized
        if minimized then
            TweenService:Create(MainFrame, TweenInfo.new(0.3), {
                Size = UDim2.new(0, 400, 0, 40)
            }):Play()
            Content.Visible = false
        else
            TweenService:Create(MainFrame, TweenInfo.new(0.3), {
                Size = UDim2.new(0, 400, 0, 500)
            }):Play()
            Content.Visible = true
        end
    end)
    
    -- Draggable
    local dragging, dragInput, dragStart, startPos
    
    TitleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = MainFrame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    TitleBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    
    UIS.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            MainFrame.Position = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end
    end)
end

-- ==================== HOTKEY ====================
UIS.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.F then
        if Config.Running then
            StopAllThreads()
            print("Training stopped via hotkey")
        end
    end
end)

-- ==================== INITIALIZATION ====================
CreateGUI()
print("✅ Ultimate Training Multiplier loaded!")
print("💡 Tekan F untuk stop training")
print("📊 Multiplier: Train=" .. Config.TrainMultiplier .. " | CP=" .. Config.CPMultiplier)
